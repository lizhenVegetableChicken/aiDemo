我们写一个曼泰斯坦单元测试的程序能test的跟普通的应用还不一样test的然后参数一定得是一个target.com 我们需要用到的是一个http test这个也是里面提供的很方便的来做测试的然后我们这个地方 测试的是一种多线程的方式所以为了保持同步我们用Simulator保证现成这种邪神全部运行完第二条这是首页了首页这样一个验证的话我们期待的一个状态肯定是OK的那种状态怎样做不起球也是正常的test test OK 我那个200 OK然后再验证一下返回值我们希望他返回的是一个怎样的词呢当前总共参与抽奖的用户数零没有用户因为我们 一次来请求和验证所以里面的用户是空的接下来我们就要去做一个循环就是来发起并发的请求了启动一个携程然后就开始要跑一个携程啊 还有一个参数这个参数需要外表传进去否则在西餐里面直接进饮用符号里面这个爱的话会出现并发安全性问题因为它是一个携程你们去读外面的一个共享变量会有问题但是我们通过这个传进去的话那么这个I一定时间的循环的时候他的一个字但这个携程执行完成之后我们写一个叠法这个程序要把这个 输入法执行一个当操作这个里面呢我们要不停地去给他搞名单post in Portugal这个人的名字 把这个跑完了之后你们后面还需要去验证一下是吧然后把这个结束 Google Maps等待上面的所有的携程运行完明天下来继续来读这个地方我们就去验证一下他的用户数了正常的话跑了100个导入那么就应该是100个用户了你的状态然后读到body的内容来比较一下当前总 开语音助手总共参与抽奖的用户数就是100个那么我们再来做一次抽奖我们来抽奖抽一次状态的验证就是一样的大家接下来自己 我们再来验证一遍根目录这个地址返回到一个字抽奖一次之后就剩99个了这个时候我们看时间的一个报错在100个携程运行完之后呢我们做了一次验证期待的一个词句期待的一个字符串呢应该是 用户说是100但是我们得到的一个用户说呢是97所以我们看到在前面100颗携程往里面倒用户的时候就出现了这个线程安全性问题没有成功的导进100克用户进去当然下面对应的抽完一个人想变成99然后就是这个地方肯定也就不对了因为前面导入的时候总用户说已经有问题了所 单元测试一下我们能看到啊我们这个地方只是做了100个携程来做这样的一个并发的导入然后返回的结果我们已经看到是只有97个这个程序里面我们就能看到它是线程不安全的后面我们再来把这个程序稍微改造一下把它改造成一个线程安全的程序